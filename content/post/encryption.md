---
title: "Encryption"
date: 2021-11-27T18:27:06+08:00
draft: false
---
# 基本概念：

**密钥**：在密码学中，用来加密，解密和验证数据完整性的秘密信息。  
**对称加密**：使用相同的密钥对数据进行加密和解密。    
**非对称加密**：加密和解密数据使用的是不同的密钥。  
**公钥**：非对称加密中，用来加密数据的密钥，可以公开。  
**私钥**：非对称加密中 ，用来解密数据的密钥，需要保密。  

**加密**：使用公钥对数据根据加密算法进行加密，简单来说就是将人类能识别的信息通过密钥和算法变成不能识别的信息。用户可以将自己的公钥通过不安全的途径传达给其他用户，其他用户通过该密钥来加密需要发送的信息。由于只有该用户有私钥，所以可以保证数据的安全性。  

**签名**：用户使用自己的私钥对信息进行加密，其他用户可用使用该用户公开的公钥来解密信息。由于私钥是该用户的秘密信息，所以可以认为这个信息是该用户发布的，其他用户可以通过公钥来验证数据的正确性和完整性。  
公钥和私钥是成对生成的，一般公钥用来加密信息，私钥用来签名。

![](/images/encrypt.png)

**PKI**：公钥基础设施，它是CA，证书，keypair的集合并描述了它们之间的关系。  
**CA**：证书颁发机构，PKI根证目录下的主要证书。  
**cert**：证书是由CA签过名的证书。它包含了：公钥信息，自身的一些描述信息和CA的数字签名。  
**request**：证书请求，它是一个即将发送给CA签名的请求。请求包含所需的证书信息以及来自私钥的数字签名。  
**keypair**：密钥对是非对称加密的密钥对。它由公钥和私钥组成，公钥包含在请求和证书中。  

## **The CA**（证书颁发机构）：

CA是整个PKI的核心也是对安全最敏感的地方。它是用来签发证书的，所以确保整个PKI的安全是至关重要的。所以非常推荐整个CA PKI的目录运行在专门为安全设计的系统中。也不要将它和其他为终端签发证书的CA混放在一起。
要创建PKI，第一个创建的就是CA（公私钥对）和相关的目录结构用来签发其他证书。所以这是非常重要的，你可以用尽一切安全的保护措施，甚至是在离线的设备或者可以动的设备中存储。
一旦CA创建就绪，它就有能力接收来自终端设备的证书签发请求，终端设备（web，VPN，或者邮件服务器和客户端）会作为消费者向它请求X509证书。这些请求和证书不是安全敏感的，但是有必要验证下请求信息和请求者的一致性。

## **Keypairs and requests**（公私钥对和签名请求）：

每个终端实例不需要设置整个CA，它们只需要创建单独的公私钥对和相关联的证书请求。私钥是终端自身的唯一标识符，所以建议使用强密码来保护它的安全。其他终端得到该私钥，服务器也会认为它这是这个终端本身。  
一旦公私钥对生成了，证书签名请求就会使用生成的私钥进行签名并发送给CA签名。CA返回签名过的证书给终端。  

## **证书请求过程**：  
CA收到证书签名请求，会用自己的私钥来签名对方的公钥，并发回给对方（因为这个不是机密信息，所以可以通过不安全的网络传输）。所以任何信任这个CA颁发机构的系统就会默认地信任这个公钥是这个终端实例的。

## **验证签发的证书**：
两个已经完成证书请求并收到可信CA签发的证书的终端实例可以互相认证对方，而且不需要提前直接交换安全信息。在一次TLS握手的过程中，建立连接的双方提供自己的证书链给对方，每一方通过自己的持有的CA公钥来验证对方的证书的可信性。因为对方的根证书都是可信的，所以认为对方是可信的 。  
双方可通过使用对方的公钥加密信息发给对方来确认证书和对方的一致性，认证通过后建立可信链接。

# 实际应用：
**HTTPS 握手**：  
![](/images/https_handshake.png)  

**证书链**：  
![](/images/cert_chain.png)  

上图中建立安全连接之前的证书认证使用的就是上面说的原理：客户端通过验证CA根证书签名的服务器端的证书可信性。

